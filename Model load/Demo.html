<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive GLTF 3D Model Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #111827; /* Tailwind gray-900 */
            color: #f3f4f6; /* Tailwind gray-100 */
        }
        #webgl-canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        .ui-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: rgba(17, 24, 39, 0.8); /* gray-900 with opacity */
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid rgba(55, 65, 81, 0.5); /* gray-700 with opacity */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            z-index: 10;
        }
        label {
            margin-right: 0.5rem;
            font-weight: 500;
        }
        select {
            background-color: #374151; /* gray-700 */
            border: 1px solid #4b5563; /* gray-600 */
            color: #f3f4f6; /* gray-100 */
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
        }
        select:focus {
            outline: none;
            box-shadow: 0 0 0 2px #3b82f6; /* blue-500 */
        }
        #loader {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            padding: 1rem 2rem;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 0.5rem;
            display: none; /* Hidden by default */
            font-size: 1.125rem;
        }
    </style>
</head>
<body>

    <!-- UI for model selection -->
    <div class="ui-container">
        <label for="model-select">Choose a Model:</label>
        <select id="model-select">
            <option value="Dragon">Dragon</option>
            <option value="Cat">Cat</option>
            <option value="Dog">Shiba Inu</option>
            <option value="Car">Vintage Car</option>
            <option value="Tank">Tank</option>
        </select>
    </div>

    <!-- Loading Indicator -->
    <div id="loader">Loading...</div>

    <!-- Canvas for WebGL rendering -->
    <canvas id="webgl-canvas"></canvas>

    <!-- Import map for three.js modules from CDN -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <!-- Main application logic -->
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // Basic scene setup
        let scene, camera, renderer, clock, mixer;
        const canvas = document.getElementById('webgl-canvas');

        // UI Elements
        const modelSelect = document.getElementById('model-select');
        const loaderElement = document.getElementById('loader');

        // Model URLs
        const models = {
            Dragon: { url: 'https://cdn.jsdelivr.net/gh/Sean-Bradley/React-Three-Fiber-Boilerplate@gltf/public/models/Dragon.glb', scale: 0.1, position: [0, -5, 0] },
            Cat: { url: 'https://threejs.org/examples/models/gltf/Cat.glb', scale: 0.02, position: [0, -1.5, 0] },
            Dog: { url: 'https://threejs.org/examples/models/gltf/ShibaInu.glb', scale: 2, position: [0, -1.5, 0] },
            Car: { url: 'https://threejs.org/examples/models/gltf/vintage_car.glb', scale: 0.4, position: [0, -1, 0] },
            Tank: { url: 'https://cdn.jsdelivr.net/gh/vns-12/a-frame-models/tank/tank.gltf', scale: 0.5, position: [0, 0, 0] },
        };
        
        let currentModel;

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111827);
            
            // Clock for animations
            clock = new THREE.Clock();

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(5, 5, 10);
            camera.lookAt(0,0,0);

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.outputEncoding = THREE.sRGBEncoding;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 2.5);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            // Controls
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(0, 1, 0);
            controls.update();

            // Grid Helper
            const gridHelper = new THREE.GridHelper(20, 20, 0x4b5563, 0x374151);
            scene.add(gridHelper);

            // Event Listeners
            window.addEventListener('resize', onWindowResize);
            modelSelect.addEventListener('change', (event) => loadModel(event.target.value));

            // Initial Load
            loadModel(modelSelect.value);

            // Start animation loop
            animate();
        }

        function loadModel(modelName) {
            // Show loader and clear previous model
            loaderElement.style.display = 'block';
            if (currentModel) {
                scene.remove(currentModel);
                currentModel = null;
            }
            if(mixer) {
                mixer.stopAllAction();
                mixer = null;
            }

            const modelData = models[modelName];
            const loader = new GLTFLoader();

            loader.load(
                modelData.url,
                (gltf) => {
                    currentModel = gltf.scene;
                    currentModel.scale.set(modelData.scale, modelData.scale, modelData.scale);
                    currentModel.position.set(...modelData.position);
                    scene.add(currentModel);

                    // Handle animations if they exist
                    if (gltf.animations && gltf.animations.length) {
                        mixer = new THREE.AnimationMixer(currentModel);
                        const action = mixer.clipAction(gltf.animations[0]);
                        action.play();
                    }

                    loaderElement.style.display = 'none'; // Hide loader
                },
                // onProgress callback (optional)
                (xhr) => {
                    const percentComplete = Math.round((xhr.loaded / xhr.total) * 100);
                    loaderElement.textContent = `Loading... ${percentComplete}%`;
                },
                // onError callback
                (error) => {
                    console.error('An error happened while loading the model:', error);
                    loaderElement.textContent = 'Error loading model.';
                }
            );
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            
            // Update animation mixer
            if (mixer) {
                mixer.update(delta);
            }

            // Update controls
            const controls = scene.getObjectByProperty('type', 'OrbitControls');
            if (controls) {
                controls.update();
            }

            renderer.render(scene, camera);
        }

        // Run the application
        init();
    </script>
</body>
</html>
