<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warehouse Showdown: Beavis vs SpongeBob</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: 'Arial Black', sans-serif; touch-action: none; }
        
        #ui {
            position: absolute; top: 10px; left: 10px; color: #ffff00;
            font-size: clamp(18px, 5vw, 28px); text-shadow: 3px 3px #000; 
            pointer-events: none; z-index: 100;
        }

        /* Visible Touch Controls */
        .controls-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 40%;
            display: flex; z-index: 200; pointer-events: none;
        }

        .touch-button {
            flex: 1; pointer-events: auto; display: flex;
            align-items: center; justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-circle {
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 4px solid rgba(255, 255, 255, 0.5);
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 40px; font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .touch-button:active .btn-circle {
            background: rgba(255, 255, 0, 0.4);
            transform: scale(0.9);
        }

        #instructions {
            position: absolute; top: 60px; width: 100%; text-align: center;
            color: #fff; font-size: 14px; pointer-events: none; opacity: 0.8; z-index: 10;
        }
    </style>
</head>
<body>

<div id="ui">SCORE: <span id="score">0</span></div>
<div id="instructions">TAP BUTTONS TO STEER BEAVIS</div>

<div class="controls-container">
    <div id="btn-left" class="touch-button">
        <div class="btn-circle">L</div>
    </div>
    <div id="btn-right" class="touch-button">
        <div class="btn-circle">R</div>
    </div>
</div>

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
        }
    }
</script>

<script type="module">
    import * as THREE from 'three';

    // --- Scene Setup ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a0d00); 
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    document.body.appendChild(renderer.domElement);

    // --- Lighting ---
    const light = new THREE.DirectionalLight(0xffffff, 1.5);
    light.position.set(5, 10, 7.5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // --- Environment ---
    const beltGeo = new THREE.PlaneGeometry(10, 200);
    const beltMat = new THREE.MeshStandardMaterial({ color: 0x222222 });
    const belt = new THREE.Mesh(beltGeo, beltMat);
    belt.rotation.x = -Math.PI / 2;
    scene.add(belt);

    const grid = new THREE.GridHelper(10, 40, 0xffff00, 0x333333);
    grid.position.y = 0.01;
    scene.add(grid);

    // --- Characters ---
    const beavis = new THREE.Group();
    const body = new THREE.Mesh(new THREE.BoxGeometry(1, 0.6, 1.4), new THREE.MeshStandardMaterial({color: 0x0000ff}));
    const head = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.8, 0.5), new THREE.MeshStandardMaterial({color: 0xffdbac}));
    head.position.set(0, 0.7, 0.3);
    beavis.add(body, head);
    beavis.position.set(-1.5, 0.5, 5);
    scene.add(beavis);

    const sponge = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 0.4), new THREE.MeshStandardMaterial({color: 0xffff00}));
    sponge.position.set(1.5, 0.6, 2);
    scene.add(sponge);

    // --- Logic ---
    let targetX = -1.5;
    let score = 0;
    let speed = 0.4;
    const obstacles = [];
    let isGameOver = false;

    const moveLeft = () => { if(!isGameOver) targetX = Math.max(targetX - 2, -4); };
    const moveRight = () => { if(!isGameOver) targetX = Math.min(targetX + 2, 4); };

    // --- Listeners ---
    window.addEventListener('keydown', (e) => {
        if (e.key === "ArrowLeft" || e.key === "a") moveLeft();
        if (e.key === "ArrowRight" || e.key === "d") moveRight();
    });

    // Improved Touch Logic
    const lBtn = document.getElementById('btn-left');
    const rBtn = document.getElementById('btn-right');

    const handleTouch = (e, callback) => {
        e.preventDefault();
        callback();
    };

    lBtn.addEventListener('touchstart', (e) => handleTouch(e, moveLeft), {passive: false});
    rBtn.addEventListener('touchstart', (e) => handleTouch(e, moveRight), {passive: false});

    camera.position.set(0, 6, 12);
    camera.lookAt(0, 0, 0);

    function spawn() {
        if(isGameOver) return;
        const box = new THREE.Mesh(
            new THREE.BoxGeometry(1.3, 1.3, 1.3), 
            new THREE.MeshStandardMaterial({color: 0x8B4513})
        );
        const lanes = [-4, -2, 0, 2, 4];
        box.position.set(lanes[Math.floor(Math.random()*lanes.length)], 0.65, -60);
        scene.add(box);
        obstacles.push(box);
    }

    setInterval(spawn, 800);

    function animate() {
        if (isGameOver) return;
        requestAnimationFrame(animate);

        grid.position.z += speed;
        if (grid.position.z > 5) grid.position.z = 0;

        beavis.position.x += (targetX - beavis.position.x) * 0.2;
        sponge.position.x = Math.sin(Date.now() * 0.003) * 3.5;

        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].position.z += speed;
            
            // Collision
            if (beavis.position.distanceTo(obstacles[i].position) < 1.3) {
                isGameOver = true;
                alert("CRASHED! Beavis: 'Uhh... fire! Fire!' \nScore: " + score);
                location.reload();
            }

            if (obstacles[i].position.z > 15) {
                scene.remove(obstacles[i]);
                obstacles.splice(i, 1);
                score += 10;
                document.getElementById('score').innerText = score;
                speed += 0.001;
            }
        }
        renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>
